# monsoonal_rescaling
This directory contains Python code for rescaling the synthetic flows generated by the synthetic generator to captures changes in the log-space mean, log-space standard deviation, and amplitudes and phase shifts of harmonics fit to the log-space anunal cycle.

An example of how to run the generator is provided here for the Susquehanna River Basin. The historical data for the Susquehanna flows at Marietta and Muddy Run from 1932-2001 are given in `../data` along with lateral inflows between Marietta and Conowingo Dam and evaporation rates over the Conowingo and Muddy Run Dams. Flows at Marietta were obtained from USGS station 01576000). Lateral inflows between Marietta and Conowingo, inflows to Muddy Run and evaporation rates over the Conowingo and Muddy Run Dams were obtained from an OASIS model simulation. The evaporation rates at the two dams and are identical to one another. Flows are given in cfs and evaporation rates in in/day.

To run the streamflow rescaling, synthetic streamflows first have to be generated following the instructions in `../stationary_generator`.

Once the synthetic flows are generated, they can be rescaled with `MonsoonalRescaling.py`. This reads in a Latin Hypercube sample of parameter changes. A sample Latin hypercube sample is provided here, but another set can be generated by downloading the [MOEAFramework demo application](http://moeaframework.org/downloads.html) and running `sh sample_parameters.sh` after editing line 3 of this file to the current version of the MOEAFramework. `MonsoonalDynamics.py` will make a subdirectory within this directory called `rescaledFlows` to which the rescaled flows will be written. It is currently set up for the Susquehanna River basin, but the sites can be modified on line 163 of `MonsoonalDynamics.py`. If the data at any of these sites is evaporation, the indices of the array corresponding to these sites can be provided to `evapIndices` on line 165 of `MonsoonalDynamics.py`.

Contents:  
`LHsamples.txt`: Sample Latin hypercube sample of streamflow characteristics. Each column corresponds to an uncertain parameter from `uncertain_params.txt`, and each row to a different sample.

`MonsoonalRescaling.py`: Re-scales the synthetic streamflows generated in `../stationary_generator`. The names of the sites can be edited on line 163, and the indices of this array which represent evaporation data on line 165.

`fitHarmonics.py`: Fits harmonics to the historical monthly mean streamflows

`sample_parameters.sh`: Calls the [MOEAFramework demo application](http://moeaframework.org/downloads.html) to generate a Latin Hypercube sample across the parameter ranges provided in `uncertain_params.txt`. The number of samples to be generated can be edited on line 1, and the version of the MOEA Framework being used on line 3.

`uncertain_params.txt`: Lists the uncertain parameters being sampled (1st column) and their minimum (2nd column) and maximum (3rd column) values to sample between
